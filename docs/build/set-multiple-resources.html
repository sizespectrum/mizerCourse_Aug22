<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>mizer course - Setting up multiple resources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../build/refine-model.html" rel="next">
<link href="../build/create-first-model.html" rel="prev">
<link href="../images/favicon-16x16.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script><script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script><script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="mizer course - Setting up multiple resources">
<meta property="og:description" content="">
<meta property="og:image" content="https://mizer.course.aug22.sizespectrum.org/build/set-multiple-resources_files/figure-html/unnamed-chunk-13-1.png">
<meta property="og:site-name" content="mizer course">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="mizer course - Setting up multiple resources">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://mizer.course.aug22.sizespectrum.org/build/set-multiple-resources_files/figure-html/unnamed-chunk-13-1.png">
<meta name="twitter:creator" content="gustavdelius">
<meta name="twitter:site" content="@mizer_model">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../build/index.html">Week 2: Build</a></li><li class="breadcrumb-item"><a href="../build/set-multiple-resources.html">Set up multiple resources</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">mizer course</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../prepare/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepare/introduce-yourself.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduce yourself</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepare/install-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prepare/use-git-and-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Use Git and GitHub</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../understand/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1: Understand</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../understand/observed-size-spectra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Observed size spectra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../understand/single-species-spectra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Single species spectra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../understand/predation-growth-and-mortality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Predation, growth and mortality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../understand/species-interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Species interactions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../understand/dynamics-of-spectra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamics of size spectra</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../build/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2: Build</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../build/find-species-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Find species parameters</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../build/create-first-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create your first model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../build/set-multiple-resources.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Set up multiple resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../build/refine-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Refine your model</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../use/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Use</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../use/tune-resilience.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tune resilience</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../use/fishing-scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explore fishing scenarios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../use/change-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Change resources</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../use/further-scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explore further scenarios</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Info</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../troubleshooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#step-1-load-mizermr" id="toc-step-1-load-mizermr" class="nav-link" data-scroll-target="#step-1-load-mizermr">Step 1: Load mizerMR</a></li>
  <li>
<a href="#step-2-set-new-resource-parameters" id="toc-step-2-set-new-resource-parameters" class="nav-link" data-scroll-target="#step-2-set-new-resource-parameters">Step 2: Set new resource parameters</a>
  <ul class="collapse">
<li><a href="#planktonic-paramters" id="toc-planktonic-paramters" class="nav-link" data-scroll-target="#planktonic-paramters">Planktonic paramters</a></li>
  <li><a href="#benthic-parameters" id="toc-benthic-parameters" class="nav-link" data-scroll-target="#benthic-parameters">Benthic parameters</a></li>
  </ul>
</li>
  <li><a href="#step-3-set-resource-interactions" id="toc-step-3-set-resource-interactions" class="nav-link" data-scroll-target="#step-3-set-resource-interactions">Step 3: Set resource interactions</a></li>
  <li><a href="#step-4-find-new-steady-state" id="toc-step-4-find-new-steady-state" class="nav-link" data-scroll-target="#step-4-find-new-steady-state">Step 4: find new steady state</a></li>
  <li><a href="#step-5-explore-model-properties" id="toc-step-5-explore-model-properties" class="nav-link" data-scroll-target="#step-5-explore-model-properties">Step 5: explore model properties</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/sizespectrum/mizerCourse_Aug22/edit/main/build/set-multiple-resources.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/sizespectrum/mizerCourse_Aug22/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Setting up multiple resources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="introduction" class="level2"><h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Most mizer models simulate multiple size structured species and one background resource. But what if you want to account for different types of ‘resources’ with different dynamics? The most obvious case is the separation of pelagic and benthic resource. Benthic resource may not be important for offshore or pelagic ecosystems, but if you want to model coastal or freshwater ecosystems this may become essential.</p>
<p>Adding benthic resource into multi-species and size based models is not new. Some researchers incorporate benthic food sources by explicitly modelling key benthic species as size-structured groups. This is fine if you have data on their biomases for calibration and if you are interested in their dynamics, but modelling many benthic species separately might be overwhelming. Instead, just like with plankton species, we might want to model all benthic organisms as a separate resource spectrum. That is what the mizerMR extension does.</p>
<p>The origin of mizerMR is a <a href="https://doi.org/10.1101/2022.06.20.496925">model for Tasmanian coastal rocky reef ecosystem</a>, where most large fish are not predators (like in a classical size based marine ecosystem), but feed on benthic invertebrates. In such reefs, benthic production pathway is likely to be a major source of energy. The mizerMR framework has also been used in a <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/gcb.16341">Baltic Sea mizer model</a> and a <a href="https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1365-2664.14086">south-east Australian mizer model</a>. There are other ways to incorporate benthic resources, and you can find some examples <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1111/geb.13348">here</a>, <a href="https://link.springer.com/article/10.1007/s12080-010-0078-9">here</a> and <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/oik.05630">here</a>, but none of these approaches are currently implemented in the main mizer code.</p>
<p>The Curonian Lagoon is a shallow water productive ecosystem, where benthic production constitutes an important source of energy. Like in many other coastal ecosystems, the most common species are benthivores.</p>
<p>In this tutorial we will modify our basic mizer model by adding an explicit benthic size structured resource.</p>
</section><section id="step-1-load-mizermr" class="level2"><h2 class="anchored" data-anchor-id="step-1-load-mizermr">Step 1: Load mizerMR</h2>
<p><a href="https://github.com/sizespectrum/mizerMR">mizerMR</a> is an extension to the mizer package and it demonstrates a flexible way of adding new features, contributed by the mizer modeller community. If you modify mizer to add new features, please consider making an extension package and making it available for all mizer users.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-1_7cec24f3681d1b8420c6a9d17fbcc43a">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sizespectrum.org/mizerMR/">mizerMR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sizespectrum/mizerExperimental">mizerExperimental</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="step-2-set-new-resource-parameters" class="level2"><h2 class="anchored" data-anchor-id="step-2-set-new-resource-parameters">Step 2: Set new resource parameters</h2>
<p>Now we load the model parameter file that we saved in the previous tutorial (you will use the file with your parameters from the exercise in the previous tutorial).</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-2_687af5b3762772d5802796f2dfab062d">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Start with existing single species params</span></span>
<span><span class="va">cur_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"cur_model_single.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to add resource parameters for the benthic resource. We will go into the details of resource dynamics and its parameters in week 3 of this course. For now we just need to know that the steady state abundance of each resource is defined by four resource parameters. Like the species parameters, these resource parameters need to be provided in the form of a data frame, with one row for each resource and one column for each resource parameter. You could put the parameters into a spreadsheet, save it as a .csv file, and then import it into R, as we did for the species parameters. Here instead we will create the data frame directly in R. The columns we need are:</p>
<ol type="1">
<li>
<code>resource</code> - name for the resource</li>
<li>
<code>kappa</code> - resource overall abundance. It sets the ‘height’ of the resource spectrum. Strictly speaking this is resource abundance (g per unit area of your study) of resource at the size of 1g.</li>
<li>
<code>lambda</code> - slope of the resource spectrum.</li>
<li>
<code>w_max</code> - largest size of the resource.</li>
<li>
<code>w_min</code> - smallest size of the resource.</li>
</ol>
<section id="planktonic-paramters" class="level3"><h3 class="anchored" data-anchor-id="planktonic-paramters">Planktonic paramters</h3>
<p>For our plankton resource we use similar parameters to those for our existing single resource. Let us look at those first. Because our model is currently set up only with a single resource, the resource parameters are not in a data frame with one row for each resource but are simply a list:</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-3_23f98233160b04ff6e90790fc195ade3">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/resource_params.html">resource_params</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$kappa
[1] 0.3831571

$lambda
[1] 2.05

$r_pp
[1] 10

$n
[1] 0.75

$w_pp_cutoff
[1] 10</code></pre>
</div>
</div>
<p>We see that this list contains also parameters that we ignore for now because they are about the dynamics rather than the steady state abundance. Also, for historical reasons, the maximum size <code>w_max</code> is called <code>w_pp_cutoff</code> in the above list. We will keep the <code>lambda</code> and <code>kappa</code> parameters for the plankton spectrum.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-4_b0e7c2cc542fcc65175602b8a195c5b9">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">kappa</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/resource_params.html">resource_params</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span><span class="op">$</span><span class="va">kappa</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/resource_params.html">resource_params</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span><span class="op">$</span><span class="va">lambda</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will reduce the maximum size of the plankton spectrum from the current value of 10 grams (which corresponds to about 10cm long fish!) to 1 gram.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-5_2f673a3f8a0f824018d539aeef233cfb">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">w_max</span> <span class="op">&lt;-</span> <span class="fl">1</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To choose a minimum size we look at the current minimum size which we can find in the first entry in the vector of size bins:</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-6_7e69fa54feff33abf5d9031cb03ba5df">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizer/reference/w.html">w_full</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.533877e-13</code></pre>
</div>
</div>
<p>We round this to <span class="math inline">10^{-12}</span>. (There is currently a problem if you try to use exactly the floating point value above, because due to rounding errors R will think that it is actually smaller than the existing smallest size and will issue an error message.)</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-7_14627b49d9f9d92d2104d9f68a100965">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">w_min</span> <span class="op">&lt;-</span> <span class="fl">1e-12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="benthic-parameters" class="level3"><h3 class="anchored" data-anchor-id="benthic-parameters">Benthic parameters</h3>
<p>Now we need to make decisions about the parameters for the benthic spectrum. We are aiming to reproduce ontogenetic diet shifts, where species start feeding on plankton and then may transition into the benthic spectrum. This means that, as plankton abundance decreases, benthos abundance should become relatively higher. To achieve that, we will start the benthos spectrum from a larger minimum size, extend it to much larger size than plankton spectrum, and have shallower slope for the benthos spectrum.</p>
<p>Ideally, you would have size based benthos abundance or biomass data and fit a linear model to get the slope. This was done for the Tasmanian model (see supplementary materials in this <a href="https://doi.org/10.1101/2022.06.20.496925">preprint</a>). For the Curonian lagoon we do not have such data, so we will just assume a slope of 1.9 instead of 2.05, but keep <code>kappa</code> equal for now. The benthic spectrum will extend to 10 grams to represent largest benthic invertebrates and some cryptic small benthic fish not explicitly included in the model.</p>
<p>We will save all resource parameters in separate variables, so we can use them later.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-8_67e5fc1f94e8b352ceb4b36cf495b11b">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set benthos kappa same as plankton kappa </span></span>
<span><span class="va">kappa_ben</span> <span class="op">&lt;-</span> <span class="va">kappa</span></span>
<span><span class="co"># Assume more shallow slope for benthos </span></span>
<span><span class="va">lambda_ben</span> <span class="op">&lt;-</span> <span class="fl">1.9</span></span>
<span><span class="co"># Set maximum benthos size </span></span>
<span><span class="va">w_max_ben</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="co"># Benthos starts at larger sizes, corresponding to about 1-2mm</span></span>
<span><span class="va">w_min_ben</span> <span class="op">&lt;-</span> <span class="fl">0.0001</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we put all these resource parameters into a data frame.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-9_48a2ea480852ecede859d77a01c32647">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">curonian_resource_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    resource <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pl"</span>, <span class="st">"bb"</span><span class="op">)</span>,</span>
<span>    lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lambda</span>, <span class="va">lambda_ben</span><span class="op">)</span>,</span>
<span>    kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">kappa</span>, <span class="va">kappa_ben</span><span class="op">)</span>,</span>
<span>    w_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">w_min</span>, <span class="va">w_min_ben</span><span class="op">)</span>,</span>
<span>    w_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">w_max</span>, <span class="va">w_max_ben</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">curonian_resource_params</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["resource"],"name":[1],"type":["chr"],"align":["left"]},{"label":["lambda"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["kappa"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["w_min"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["w_max"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"pl","2":"2.05","3":"0.3831571","4":"1e-12","5":"1"},{"1":"bb","2":"1.90","3":"0.3831571","4":"1e-04","5":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We can now update our Curonian model to use these resource parameters with</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-10_1a85a991a1abe0b661f7699429a33a30">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/resource_params.html">resource_params</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">curonian_resource_params</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The resource carrying capacity has been commented and therefore will not be recalculated from the resource parameters.</code></pre>
</div>
</div>
</section></section><section id="step-3-set-resource-interactions" class="level2"><h2 class="anchored" data-anchor-id="step-3-set-resource-interactions">Step 3: Set resource interactions</h2>
<p>The next and most interesting step is to define the availability of each resource to our model species. This is where our biological and ecological knowledge comes in, but we may need to adjust these values to ensure we get the expected ontogenetic diet shifts.</p>
<p>By default all resource interactions are set to 1.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-11_7df1c588359868937966867415e7304a">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/setMultipleResources.html">resource_interaction</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               resource
sp              pl bb
  smallfish      1  1
  ruffe          1  1
  breams         1  1
  roach          1  1
  vimba          1  1
  carassius      1  1
  perch          1  1
  pikeperch      1  1
  burbot         1  1
  predator_fish  1  1</code></pre>
</div>
</div>
<p>In this simple model we will assume that largely planktivorous small fish have full access to the plankton resource, and can only access a small fraction (0.2) of the benthic resource. For benthivorous fish, like vimba, carassius, breams, roach and ruffe we give full access to the benthic resource and reduce availability of plankton to 0.5. Remember, all fish start by feeding on plankton, so they all should have enough access to the plankton resource. We might need to increase this value if it seems that small fish don’t grow fast enough. For a small sized ruffe we increase plankton availability to 0.8. For predatory fish we set both plankton and benthos availability to 0.5. This is to ‘encourage’ them to start feeding on other fish.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-12_f0942e3085fd1009723987b855c0cff2">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#set vectors of plankton and benthos availability for the model species </span></span>
<span><span class="va">plankton_avail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">benthos_avail</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#put them into corresponding columns of resource_interaction matrix</span></span>
<span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/setMultipleResources.html">resource_interaction</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">plankton_avail</span></span>
<span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/setMultipleResources.html">resource_interaction</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">benthos_avail</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, like with the species interaction matrix, you could also have set up the resource interaction matrix in an external spreadsheet program and then imported it from a .csv file.</p>
</section><section id="step-4-find-new-steady-state" class="level2"><h2 class="anchored" data-anchor-id="step-4-find-new-steady-state">Step 4: find new steady state</h2>
<p>We have now changed resource availability quite a bit. This has changed the growth rates and hence we need to recalculate the steady state. We will use the same set of functions as in the single resource model in the previous tutorial.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-13_a5f0ffc703582df20fa529060825a7c1">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cur_model</span> <span class="op">&lt;-</span> <span class="fu">steady</span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 18 years.</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">cur_model</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note how the plot now displays both resources. The change in resource will of course also have had an effect on the species abundances, so the model biomasses will no longer match the observed biomasses:</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-14_bc368946d127cfb57fd3d3ccc0912b06">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mizerExperimental/man/plotBiomassVsSpecies.html">plotBiomassVsSpecies</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Luckily we already know from the previous tutorial what to do: repeatedly match the biomasses with <code><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses()</a></code> and run back to steady state with <code>steady()</code> until we converge to a steady state with the correct biomasses.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-15_96d3cca66468c5485f75d5e742ad4439">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># repeat a few more times (in case your parameters take longer to converge)</span></span>
<span><span class="va">cur_model</span> <span class="op">&lt;-</span> <span class="va">cur_model</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://sizespectrum.org/mizer/reference/matchBiomasses.html">matchBiomasses</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">steady</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 16.5 years.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 15 years.
Convergence was achieved in 15 years.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 10.5 years.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 6 years.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Convergence was achieved in 1.5 years.</code></pre>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mizerExperimental/man/plotBiomassVsSpecies.html">plotBiomassVsSpecies</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-16_f5feddbf8372d20b9ca1e575d0153c4b">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/plotSpectra.html">plotSpectra</a></span><span class="op">(</span><span class="va">cur_model</span>, power <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let us save the model. We choose the file name to reflect that the model is still not finely tuned. We will improve it in the next tutorial.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-17_a8ca8022efb51a6c9da2ad158f2d9b56">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizer/reference/saveParams.html">saveParams</a></span><span class="op">(</span><span class="va">cur_model</span>, <span class="st">"cur_model_coarse.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="step-5-explore-model-properties" class="level2"><h2 class="anchored" data-anchor-id="step-5-explore-model-properties">Step 5: explore model properties</h2>
<p>Let’s check the diets and see if we can now observed ontogenetic diet shifts.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-18_a100c7ac906d048454d42eb39fd88960">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizerMR/reference/plotDiet.html">plotDiet</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is looking reasonably good. Benthivores, such as ruffe, breams, roach, vimba and carrasius start in the plankton spectrum and then transition to feeding on benthos. They don’t transition fully, which we need to work on. Adult benthivores should really only eat benthos and no plankton. We can probably fix that by increasing abundance <code>kappa</code> for the benthic resource or making its slope <code>lambda</code> even more shallow. Predators nicely start on plankton, transition to benthos and then to fish. For the largest predators, such as predator_fish and pikeperch we want adult diets to consist almost entirely of fish. So we might need to reduce benthic resource availability to these species. You can do that now and explore the outcomes, or we will do it in the next tutorial.</p>
<p>Next, let’s have a look at the sources of death. We will plot them as proportional and as absolute rates.</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-19_24d5ee6bce8c54ef3354d930192be1df">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mizerExperimental/man/plotDeath.html">plotDeath</a></span><span class="op">(</span><span class="va">cur_model</span>, proportion <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/mizerExperimental/man/plotDeath.html">plotDeath</a></span><span class="op">(</span><span class="va">cur_model</span>, proportion <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that unlike in the trait based model, where mortality was decreasing as a power law, the absolute mortality rate curves now look like bell-shaped curves. Mortality rates on smallest fish are actually very small. This is for three reasons. First, at these sizes we have A LOT of resource, so predators in the model do not eat small fish which are relatively less abundant. Second, we do not have all that many predators in this ecosystem, so they don’t exert extensive mortality (although mortality at about 1 g size is pretty high). Third, in real ecosystems, resource (plankton and small organisms) would be feeding on fish eggs and larvae, but our resources do not feed. Such belled shaped natural mortality curves seem to be common in multi-species models, and we don’t yet have a good solution to address them. We could, like in trait-based models impose external mortality to make sure that mortality scales with a power law. However, unlike in the idealised trait-based models we do not know how much natural mortality will actually occur in a multi-species model. So deciding the extra mortality level to add is difficult. During the week 3 we will be refining this model and mortality curves might change. But this aspect illustrates the fact that multi-species modelling is a rapidly developing field, and we don’t yet know how best to represent complex ecosystems in a simplified model.</p>
<p>We also want to know about the predation on both resources, so we will plot that too</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-20_459d9c69fdc8fe3ad362783ab8798df0">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plotResourcePred</span><span class="op">(</span><span class="va">cur_model</span>, proportion <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plotResourcePred</span><span class="op">(</span><span class="va">cur_model</span>, proportion <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is interesting to see how the highest absolute mortality (plots with proportion = F) is at resource size of about 0.1g (1e-1) and this applies to both benthos and plankton. Smallest sizes of plankton are not eaten at all, as no fish feed in that size range. Also the absolute mortality is higher on benthos (&gt; 0.8/year) than on plankton (0.5/year). Still this mortality is low and we should probably decrease the overall resource abundance, to achieve more realistic values. Let’s see if we can address this in week 3.</p>
<p>Finally, let’s check whether species are growing properly, given that resource availabilities to them have now been changed. We will also look at the feeding level of all species</p>
<div class="cell" data-hash="set-multiple-resources_cache/html/unnamed-chunk-21_e3e0ba3dfeb0d602bee355b741e8f648">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizer/reference/plotGrowthCurves.html">plotGrowthCurves</a></span><span class="op">(</span><span class="va">cur_model</span>, species_panel <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://sizespectrum.org/mizer/reference/plotFeedingLevel.html">plotFeedingLevel</a></span><span class="op">(</span><span class="va">cur_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="set-multiple-resources_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that smallest fish (smallfish and ruffe) and benthivores are growing pretty well, although predators should probably be growing a little faster. Feeding levels look reasonable and surprisingly close to the default larval value of <code>f0</code> = 0.6. This means that slow growth rates of predators are likely not due to the lack of food, but insufficient intake rates.</p>
<p>You can play with the <code><a href="https://sizespectrum.org/mizerMR/reference/setMultipleResources.html">resource_interaction()</a></code> and resource parameters (<code>kappa</code> and <code>lambda</code>), but this will be our main goal in the next tutorial on refining our models.</p>
</section><section id="exercise" class="level2"><h2 class="anchored" data-anchor-id="exercise">Exercise</h2>
<p>In this exercise please follow all these steps needed to modify the model you built in the last tutorial to include a benthic resource. Use the worksheet “worksheet-3-set-multiple-resources.Rmd” for this tutorial to submit your result.</p>
</section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>1) The <a href="https://sizespectrum.org/mizerMR/">“mizerMR” package</a> extends mizer to allow for multiple resource spectra.</p>
<p>2) The resource parameters are collected in a data frame with one row for each resource. They are added to the model with <code><a href="https://sizespectrum.org/mizerMR/reference/resource_params.html">resource_params()</a></code>.</p>
<p>3) The strength with which species feed on the different resources is set with <code><a href="https://sizespectrum.org/mizerMR/reference/setMultipleResources.html">resource_interaction()</a></code>.</p>
<p>4) Finding a steady state with the desired species biomasses proceeds in the same manner as for a model with a single resource.</p>
<p>5) We chose parameters for the plantonic and the benthic resource to get the desired ontogenetic shift in the fish diets.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/mizer\.course\.aug22\.sizespectrum\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><script src="https://giscus.app/client.js" data-repo="sizespectrum/mizerCourse_Aug22" data-repo-id="R_kgDOHlJwYg" data-category="Comments" data-category-id="DIC_kwDOHlJwYs4CP_7j" data-mapping="title" data-reactions-enabled="0" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../build/create-first-model.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Create your first model</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../build/refine-model.html" class="pagination-link">
        <span class="nav-page-text">Refine your model</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>